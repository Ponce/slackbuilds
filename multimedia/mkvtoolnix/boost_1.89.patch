From 0ee13882869a9d75a1011c928e36692cf86305a9 Mon Sep 17 00:00:00 2001
From: Moritz Bunkus <mo@bunkus.online>
Date: Mon, 11 Aug 2025 22:54:05 +0200
Subject: [PATCH] =?UTF-8?q?Boost:=20require=20=E2=89=A5=20v1.74.0;=20only?=
 =?UTF-8?q?=20require=20header=20for=20boost::system=20library?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

fixes #6143
---
 NEWS.md         | 13 +++++++++++++
 README.md       |  2 +-
 Rakefile        |  1 -
 ac/boost.m4     | 10 ++++------
 build-config.in |  1 -
 5 files changed, 18 insertions(+), 9 deletions(-)

diff --git a/NEWS.md b/NEWS.md
index b92b63540..73cdc88c3 100644
--- a/NEWS.md
+++ b/NEWS.md
@@ -1,3 +1,16 @@
+# Version ?
+
+## Bug fixes
+
+* build system: fixed building with the upcoming Boost v1.89.0 by only
+  requiring the header part of the Boost.System library as it's been
+  header-only since v1.69.0. Fixes #6143.
+
+## Build system changes
+
+* Boost v1.74.0 or newer is now required.
+
+
 # Version 94.0 "Initiate" 2025-07-27
 
 ## New features and enhancements
diff --git a/README.md b/README.md
index 363fd3061..580abac3c 100644
--- a/README.md
+++ b/README.md
@@ -100,7 +100,7 @@ programs and libraries you absolutely need are:
 
 - [Boost](http://www.boost.org/) â€” Several of Boost's libraries are
   used, e.g. `filesystem`, `multi-precision`, `operators`,
-  `system`. At least v1.66.0 is required.
+  `system`. At least v1.74.0 is required.
 
 - [libxslt's xsltproc binary](http://xmlsoft.org/libxslt/) and
   [DocBook XSL stylesheets](https://sourceforge.net/projects/docbook/files/docbook-xsl/)
diff --git a/Rakefile b/Rakefile
index 8d16961e5..572332cb0 100644
--- a/Rakefile
+++ b/Rakefile
@@ -1090,7 +1090,6 @@ end
 # libraries required for all programs via mtxcommon
 $common_libs = [
   :boost_filesystem,
-  :boost_system,
   :flac,
   :z,
   :pugixml,
diff --git a/ac/boost.m4 b/ac/boost.m4
index cef6bcb22..f3341e5fb 100644
--- a/ac/boost.m4
+++ b/ac/boost.m4
@@ -1,5 +1,5 @@
 # boost's headers must be present.
-AX_BOOST_BASE([1.66.0])
+AX_BOOST_BASE([1.74.0])
 
 AC_MSG_CHECKING([for Boost's multi-precision library with GMP backend])
 
@@ -37,7 +37,9 @@ fi
 AC_MSG_RESULT([yes])
 
 # boost::system must be present.
-AX_BOOST_SYSTEM()
+AX_BOOST_CHECK_HEADERS([boost/system.hpp],,[
+  AC_MSG_ERROR([Boost's system library is required but wasn't found])
+])
 
 # boost::filesystem must be present.
 AX_BOOST_FILESYSTEM()
@@ -46,10 +48,6 @@ if test x"$ax_cv_boost_filesystem" != "xyes"; then
   AC_MSG_ERROR(The Boost Filesystem Library was not found.)
 fi
 
-if test x"$ax_cv_boost_system" != "xyes"; then
-  AC_MSG_ERROR(The Boost System Library was not found.)
-fi
-
 AX_BOOST_CHECK_HEADERS([boost/operators.hpp],,[
   AC_MSG_ERROR([Boost's Operators library is required but wasn't found])
 ])
diff --git a/build-config.in b/build-config.in
index 715cc9f8f..117e3877c 100644
--- a/build-config.in
+++ b/build-config.in
@@ -78,7 +78,6 @@ WINDRES = @WINDRES@
 BOOST_CPPFLAGS = @BOOST_CPPFLAGS@
 BOOST_FILESYSTEM_LIB = @BOOST_FILESYSTEM_LIB@
 BOOST_LDFLAGS = @BOOST_LDFLAGS@
-BOOST_SYSTEM_LIB = @BOOST_SYSTEM_LIB@
 CMARK_CFLAGS = @CMARK_CFLAGS@
 CMARK_LIBS = @CMARK_LIBS@
 COMPILER_TYPE = @COMPILER_TYPE@
